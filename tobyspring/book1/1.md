# 오브젝트와 의존관계

스프링이 자바에서 가장 중요하게 두는 가치는 객체지향이다.

애플리케이션에서 오브젝트가 생성되고 다른 오브젝트와 관계를 맺고 사용되고 소멸까지 전 과정을 알아야 한다.

1장은 스프링이 어떤 것이고 무엇을 제공하는보다는 스프링이 관심을 갖는 대상인 **오브젝트 설계와 구현, 동작원리**에 더 집중한다.

## 1.1 DAO

```java
@Getter @Setter
public class User {
    String id;
    String name;
    String password;
}
```
> 자바빈
> - 디폴트 생성자: 자바빈은 파라미터가 없는 디폴트 생성자를 가지고 있어야 한다. 프레임워크에서 리플렉션을 이용해 오브젝트를 생성하기 때문이다.
> - 프로퍼티: Getter, Setter를 가지고 있어야 한다.

### 1.1.2 UserDao

JDBC를 이용하는 일반적 순서는 다음과 같다.

1. DB 연결을 위한 Connection을 가져온다.
2. SQL을 담은 Statement를 만든다.
3. Statement를 실행한다.
4. 조회의 경우 SQL 쿼리 실행 결과를 ResultSet을 받아서 오브젝트로 만든다.
5. Connection, Statement, ResultSet 같은 리소스를 닫아준다.
6. 예외가 발생하면 처리하거나 던진다.

```java
public class UserDao {
    public void add(User user) throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.jdbc.Driver");
        Connection c = DriverManager.getConnection("jdbc:mysql://...");
        
        PreparedStatement ps = c.prepareStatement("insert into users ...");
        
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());

        ps.executeUpdate();

        ps.close();
        c.close();
    }

    public User get(String id) throws ClassNotFoundException, SQLException {
        Class.forName("com.mysql.jdbc.Driver");
        Connection c = DriverManager.getConnection("jdbc:mysql://...");
        
        PreparedStatement ps = c.prepareStatement("select * from users ...");
        ps.setString(1, id);
        
        ResultSet rs = ps.executeQuery();
        rs.next();
        
        User user = new User();
        user.setId(rs.getString("id"));
        user.setName(rs.getString("name"));
        user.setPassword(rs.getString("password"));

        rs.close();
        ps.close();
        c.close();
        
        return user;
    }
}
```

지금 만든 DAO는 많은 문제가 있다.

## 1.2 DAO의 분리

### 1.2.1 관심사의 분리

개발의 끝은 없다. 사용자의 비즈니스 프로세스와 그에 따른 요구사항은 끊임없이 변한다. 그래서 개발자가 염두해 두어야 할 사항은 미래를 어떻게 대비할 것인가이다. 

**이를 설계하는 것이 분리와 확장을 고려하는 것이다.**

먼저 분리는 "DB를 오라클에서 MySQL로 바꾸고 싶다", "DB의 암호를 바꾸고 싶다" 등의 요청사항이 들어왔을 때 수 천개의 DAO를 변경할 수도 있다.

**변화가 한 번에 한 가지 관심에 집중되어서 일어난다면 한 가지 관심이 한 군데에 집중되게 하는 것이다. 즉 관심이 같은 것끼리 모으고 아닌 것은 분리하는 것이다.**

### 1.2.2 커넥션 만들기의 추출

UserDAO를 보면 `add()` 메서드에 적어도 세 가지 관심사항을 발견할 수 있다.

```java
public void add(User user) throws ClassNotFoundException, SQLException {
    // 1. DB 연결 커넥션
    Class.forName("com.mysql.jdbc.Driver");
    Connection c = DriverManager.getConnection("jdbc:mysql://..."); 
    
    // 2. Statement 생성 및 실행
    PreparedStatement ps = c.prepareStatement("insert into users ...");
    ps.setString(1, user.getId()); // 2. Statement 생성 및 실행
    ps.setString(2, user.getName()); // 2. Statement 생성 및 실행
    ps.setString(3, user.getPassword()); // 2. Statement 생성 및 실행
    ps.executeUpdate();

    // 3. 리소스 해제
    ps.close(); 
    c.close();
}
```

**[중복 코드의 메서드 추출]**

중복된 DB 연결 커넥션 코드는 `getConnection()` 이라는 독립적인 메서드로 만든다.

```java
private Connection getConnection() {
    Class.forName("com.mysql.jdbc.Driver");
    Connection c = DriverManager.getConnection("jdbc:mysql://...");
    return c;
}
```
DB 연결 커넥션이 변경될 시 메서드 변경 시 전부가 아닌 `getConnection()`만 변경하면 된다.

